<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Message Idea Deck</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Tailwind's gray-50 */
        }
        .tone-btn.active {
            background-color: #4f46e5; /* Indigo-600 */
            color: white;
            border-color: #4f46e5;
        }
        .card-carousel {
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none;  /* Internet Explorer 10+ */
        }
        .card-carousel::-webkit-scrollbar {
            display: none; /* Safari and Chrome */
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // --- Helper Components ---
        
        const CopyIcon = ({ copied }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                {copied ? (
                    <path d="M20 6 9 17l-5-5" />
                ) : (
                    <>
                        <rect width="14" height="14" x="8" y="8" rx="2" ry="2" />
                        <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" />
                    </>
                )}
            </svg>
        );

        const SkeletonLoader = () => (
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 animate-pulse">
                {[...Array(3)].map((_, i) => (
                    <div key={i} className="bg-gray-200 rounded-xl p-6 space-y-4">
                        <div className="h-4 bg-gray-300 rounded w-3/4"></div>
                        <div className="h-4 bg-gray-300 rounded w-full"></div>
                        <div className="h-4 bg-gray-300 rounded w-1/2"></div>
                    </div>
                ))}
            </div>
        );


        // --- Main App Component ---
        const App = () => {
            const [prompt, setPrompt] = useState('');
            const [tone, setTone] = useState('Friendly');
            const [generatedMessages, setGeneratedMessages] = useState([]);
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null);
            const [copySuccessIndex, setCopySuccessIndex] = useState(null);

            const tones = ['Friendly', 'Formal', 'Excited', 'Urgent'];

            const handleGenerate = async (e) => {
                e.preventDefault();
                if (!prompt.trim()) {
                    setError('Please describe the message you want to create.');
                    return;
                }

                setIsLoading(true);
                setError(null);
                setGeneratedMessages([]);
                setCopySuccessIndex(null);
                
                // *** IMPORTANT CHANGE FOR DEPLOYMENT ***
                // Use a relative path so it works on Render.
                const backendUrl = '/api/generate';
                
                const fullPrompt = `Based on the following request, generate 3 distinct WhatsApp message variations. The user's request is: "${prompt}". The desired tone is "${tone}". Respond with ONLY a valid JSON array of 3 strings. Example: ["Message 1", "Message 2", "Message 3"]`;

                try {
                    const response = await fetch(backendUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ prompt: fullPrompt }),
                    });

                    if (!response.ok) {
                        const errData = await response.json();
                        throw new Error(errData.error || 'The server returned an error.');
                    }
                    
                    const data = await response.json();
                    
                    try {
                        const parsedMessages = JSON.parse(data.message);
                        if (Array.isArray(parsedMessages) && parsedMessages.length > 0) {
                            setGeneratedMessages(parsedMessages);
                        } else {
                            throw new Error("AI did not return a valid list of messages.");
                        }
                    } catch (parseError) {
                        console.error("Failed to parse AI response:", data.message);
                        setGeneratedMessages([data.message]);
                    }

                } catch (err) {
                    console.error("API call failed:", err);
                    setError(err.message || 'An unknown error occurred. Is the backend running?');
                } finally {
                    setIsLoading(false);
                }
            };

            const handleCopy = (text, index) => {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                setCopySuccessIndex(index);
                setTimeout(() => setCopySuccessIndex(null), 2500);
            };

            return (
                <main className="min-h-screen w-full flex items-center justify-center p-4">
                    <div className="w-full max-w-4xl mx-auto">
                        <div className="bg-white border border-gray-200/80 rounded-2xl shadow-lg shadow-gray-200/50 p-6 md:p-10 space-y-8">
                            
                            <header className="text-center">
                                <h1 className="text-3xl md:text-4xl font-extrabold text-gray-900 tracking-tight">AI Message Idea Deck</h1>
                                <p className="text-gray-500 mt-3 max-w-xl mx-auto">Get multiple message options in seconds. Describe your goal, pick a tone, and let AI write for you.</p>
                            </header>

                            <form onSubmit={handleGenerate} className="space-y-6">
                                <div>
                                    <label htmlFor="prompt" className="block text-sm font-semibold text-gray-800 mb-2">1. What's the message about?</label>
                                    <textarea
                                        id="prompt"
                                        rows="3"
                                        value={prompt}
                                        onChange={(e) => setPrompt(e.target.value)}
                                        placeholder="e.g., A special 25% discount for Diwali to loyal customers"
                                        className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-shadow duration-200 shadow-sm"
                                        disabled={isLoading}
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-semibold text-gray-800 mb-2">2. What's the tone?</label>
                                    <div className="flex flex-wrap gap-2">
                                        {tones.map(t => (
                                            <button
                                                key={t}
                                                type="button"
                                                onClick={() => setTone(t)}
                                                className={`tone-btn px-4 py-1.5 text-sm font-medium border rounded-full transition-all duration-200 ${tone === t ? 'active' : 'bg-white hover:bg-gray-100 border-gray-300'}`}
                                            >
                                                {t}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                
                                <button
                                    type="submit"
                                    disabled={isLoading}
                                    className="w-full flex items-center justify-center bg-indigo-600 text-white font-semibold py-3 px-6 rounded-xl hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-indigo-400 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-[1.02] shadow-lg shadow-indigo-500/20"
                                >
                                    {isLoading ? 'Crafting Ideas...' : 'âœ¨ Generate Ideas'}
                                </button>
                            </form>
                            
                            {(isLoading || error || generatedMessages.length > 0) && (
                                <div className="border-t border-gray-200 pt-8">
                                    <h2 className="text-xl font-bold text-gray-800 mb-4">Your Message Ideas</h2>
                                    {error && <div className="bg-red-100 text-red-700 p-4 rounded-lg">{error}</div>}
                                    {isLoading && <SkeletonLoader />}
                                    
                                    {!isLoading && generatedMessages.length > 0 && (
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                                            {generatedMessages.map((msg, index) => (
                                                <div key={index} className="bg-gray-50/80 border border-gray-200/90 rounded-xl p-5 flex flex-col justify-between h-full fade-in" style={{animationDelay: `${index * 100}ms`}}>
                                                    <p className="text-gray-700 text-base leading-relaxed mb-4">{msg}</p>
                                                    <button 
                                                        onClick={() => handleCopy(msg, index)}
                                                        className="mt-auto w-full flex items-center justify-center gap-2 text-sm font-medium py-2 px-4 rounded-lg transition-colors duration-200 bg-white border border-gray-300 hover:bg-indigo-50 text-gray-700"
                                                    >
                                                        <CopyIcon copied={copySuccessIndex === index} />
                                                        {copySuccessIndex === index ? 'Copied!' : 'Use This Idea'}
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            )}

                        </div>
                    </div>
                </main>
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);

    </script>

</body>
</html>
